import { readdir, readFile, writeFile } from "fs/promises";
import { join } from "path";
import { fileURLToPath } from "url";

const files = await readdir(fileURLToPath(import.meta.resolve("../src/docs")), {
  withFileTypes: true,
  recursive: true,
});
const markdownFiles = files.filter((file) => file.isFile() && file.name.endsWith(".md"));

await Promise.all(
  markdownFiles.map(async (file) => {
    const content = await readFile(join(file.path, file.name), "utf-8");

    const jsonMarkdown = [
      "// This file is generated by a script and should not be modified directly.",
      `const markdown: string = ${JSON.stringify(content)};`,
      `export default markdown`,
    ].join("\n");

    await writeFile(join(file.path, `${file.name}.ts`), jsonMarkdown, "utf-8");
  })
);
